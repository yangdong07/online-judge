

## 表达式计算


### 简单的四则运算表达式（加减乘除括号）

参考 https://www.geeksforgeeks.org/expression-evaluation/

其主要思想是使用两个栈分别保存 操作数（operand）和操作符（operator）。


#### 加减运算，无括号，无乘除法

这是最简单的情况。 甚至不需要栈： 

1. 初始状态： 1个操作数0， 1个操作符 `'+'`（如果表达式开始不是 `'-'` ）
2. 读取1个新的操作数，处理前两个操作数和操作符，变成1个操作数；
3. 尝试读取1个新的操作符。并重复第2步。

```cpp
int evaluate(char *s)
{
    int a = 0, b = 0;
    char op = '+';  // default
    for (char *p = s; *p; ++p)
    {
        if (*p == '+' || *p == '-')
        {
            if (op == '+') a += b;
            else if (op == '-') a -= b;
            op = *p;
            b = 0;
        }
        else if ('0' <= *p && *p <= '9')
            b = b * 10 + *p - '0';
    }
    if (op == '+') a += b;
    else if (op == '-') a -= b;
    return a;
}
```
这里必须在最后再根据 `op` 处理一下两个操作数。


#### 加减乘除运算，无括号

从这里开始需要考虑优先级，并且要用到栈

1. 读取操作数，压入值栈
2. 读取操作符，处理栈中高于此操作符优先级的 operator和 对应数值。压入操作符。 这是 **为了保证栈中所有操作符的优先级为严格的升序**，以便在在最后的时候反向应用各个操作符。

#### 加减乘除运算，有括号

括号作为一个 **改变运算优先级的 特殊符号**，可以用来提前计算一部分的表达式（ **一段优先级严格升序操作符** ）