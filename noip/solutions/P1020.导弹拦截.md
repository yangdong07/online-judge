### P1020 导弹拦截

算法标签: **动态规划,动规,dp**, **贪心**
其他标签: **NOIp普及组**, **1999**, **Special Judge**


#### Description

#### Analysis

导弹拦截是求一个 最大下降子序列长度的问题。可以根据 DP 方法 $O(n^2)$ ，或者一种 $O(n\log n)$ 方法解决。

它的第二个问是， 问最少能用多少个下降子序列覆盖整个序列。

用到了一个 定理： Dilworth定理，是关于偏序集的一个定理。原定理是：一个有限偏序集，最少可以用 $m$ 个chain 覆盖整个集合， $m$ 等于最大 anti-chain 的长度。

其中 chain 是指有序链： 指其中所有元素都是相互可比较的（因此可以构成一个有序链）； anti-chain 是指其中所有元素都是相互间不可比较的。 

序理论实际上是对 **比较操作** 的一种深度抽象。理解起来还是有点费劲的。但是可以转成具体的问题帮助理解。

比如在这里，可以稍微变化一下 Dilworth定理，得到这样的结论：最少可以用 $m$ 个下降子序列覆盖整个序列， $m$ 等于最长单调上升子序列的长度。

可以借鉴 [wiki Dilworth定理](https://en.wikipedia.org/wiki/Dilworth%27s_theorem)， 来证明这一点，用到数学归纳法。 
1. 假设一个数列 $P$ 最少能用 $m$ 个下降子序列覆盖整个序列， $m$ 等于最长单调上升子序列的长度。
2. 令 $C_1, C_2, \cdots, C_m$ 是这样的下降子序列； 记 $A = \{ a_1, a_2, \cdots, a_m\}$ 为任意一个最长单调上升子序列（不止一个）。
3. 任意两个 $a_i, a_j \in A$ 都不可能同时出现在某一个 $C_k$ 中。这一点很容易看出来。
4. $A \cap C_i \neq \emptyset$ 对任意 $i = 1,2, ..., m$。 因为如果 $A \cap C_i = \emptyset$ ，根据抽屉原理，至少有一个 $C_k$ 有两个 $A$ 中的元素。这是不对的（3）
5. 令 $x_i$ 是 $P$ 的所有 $A$ 与 $C_i$ 的交集最小的元素 （尽可能的小），对任意 $A$， $y \in A \cap C_i$， $y \geq x_i$
6. 可以证明： $A = \{x_1, x_2, \cdots, x_m\}$ 也是一个最长单调上升子序列。 令 $A_j$ 是包含 $x_j$ 的最长单调上升子序列， 则 对于 $i < j$， $A_j \cap C_i = \{y\}$， $x_i \leq y < x_j$， 所以 $i < j, x_i < x_j$， $A$ 是一个单调上升子序列，具有最长长度 $m$。

以上都是根据假设推断出来的结论。

下面用数学归纳法证明这个假设成立。

1. 对一个新的数 $a_{n+1}$，加入到数列 $P$ 中。 如果对某些 $x_i$ ，有$a_{n+1} \leq x_i$。 令 $K = \{a_{n+1}\} \cup \{z\in C_i: z\geq x_i\}$， 注意 $K$ 的构造，在原 Dilworth定理证明中，$K$ 是一个链。但在这里，简单认为这是一个下降子序列就行了。 它的意思是如果 $a_{n+1} \leq x_i$，在 $C_i$ 集上，用 不小于$x_i$ 的点，加上 $a_{n+1}$ 点，构成一个新的下降子序列 $K$。 
2. $P - K$ 数列上，不可能存在长度为 $m$ 的anti-chain（严格上升子序列）。为什么？如果有，就会在$C_i$ 中找到一个新的 $x_i' < x_i$，与上面的 $x_i$ 的选择矛盾。
3. $P -K$ 上存在长度为 $m-1$ 的anti-chain，就是 $A - \{ x_i\}$。按照归纳假设， $P-K$ 存在一个大小为 $m - 1$ 的最小覆盖集。 这时候把 $K$ 加入 最小覆盖集合， 把 $x_i$ 还给 $A$， 覆盖集大小仍然是 $m$，最长反链长度仍然是 $m$。
4. 同时需要注意： $P + \{a_{n+1}\}$ 不会有更长的反链，因为如果有，则 $a_{n+1}$ 必定在反链中，$a_{n + 1} > x_i$ 对任意 $i$ ，与 $a_{n+1} \leq x_i$ 假设矛盾。  
5. $P + \{a_{n+1}\}$ 不会有更小的最小覆盖集，如果有，去掉 $a_{n+1}$，得到了一个大小小于 $m$ 的 $P$ 的最小覆盖集，矛盾。

上面是对某些 $x_i$， $a_{n+1} \leq x_i$ 的情况。 下面说明对所有 $x_i$， $a_{n+1} > x_i$。

1. 把 $a_{n+1}$ 加入 $A$，就可以得到一条长度为 $m+1$ 的反链 $A'$。
2. $a_{n+1}$ 不可能加入任意的 $C_i$，因为 $a_{n+1} > x_i$。用 $\{C_1, C_2, \cdots, C_m\} + \{\{a_{n+1}\}\}$ 得到一个大小为 $m +1$ 的覆盖集。
3. 不可能有更长的反链，显而易见。
4. 不可能有更小的覆盖集，因为如果有一个小于 $m + 1$ 的覆盖集覆盖 $P + \{a_{n+1}\}$，假设大小为 $m$，从覆盖集中把 $a_{n+1}$ 去掉就是 $P$ 的最小覆盖集，但是再把 $a_{n+1}$ 加回去就会产生矛盾。

对于 $|P| = 0$ 的情况，Dilworth定理成立， 按照归纳假设，对于任意有限偏序集 $P$，最小覆盖集大小等于最长反链长度。证毕。

注意把上面证明过程中的下降子序列 $\geq$， 改成偏序理论中的可比较（comparable）， 把单调上升 $<$ 改成偏序理论中的不可比较，证明逻辑也是不变的。


考虑一个有趣的数列，推翻了我之前的简单构想：`9 8 7 8 7 6 7 6 5` 这是一个折线序列。 可以用最少2个下降子序列覆盖： `9 8 8 6 6 5` 和 `7 7 7` ， 因为最长的单调上升子序列的长度为 2， 比如 `7 8` 或者 `6 7` 。 这两个下降子序列可以是交错的。




#### [Code](../cpp/p1020.cpp) 

