
### P1063 能量项链

算法标签: **动态规划,动规,dp**, **环状区间DP**
其他标签: **NOIp提高组**, **2006**

#### Description

#### Analysis

这一题与合并石子（P1880）有异曲同工之妙。

也需要先断环成链，然后求区间最优解。

刚开始如果不清楚状态方程怎么写，可以观察例子，会容易找到思路。（下面是直接的答案）

令 $dp(i, j)$ 表示区间 $[i, j]$ 按某种合并之后可以得到的最大能量。

注意这里没有首尾两个珠子合并的可能性，所以只是一个链的解。最后的环解，需要再遍历一遍断链位置找最优解。

$$dp(i, j) = \max_{i\leq k < j}{dp(i, k) + dp(k + 1, j) + a_ia_{k + 1}a_{j + 1}}$$

状态方程得到，问题就解决一大半了。

将 $dp(i, j)$ 用矩阵表示，可以发现是一个上三角矩阵： $i \leq j$， $dp(i, i) = 0$， 最后的答案是 $\max_{0\leq i < n}{dp(i, i + n - 1)}$

注意 $i, j$ 的范围： $0 \leq i < n$， $i \leq j < 2n$， 最好开个 $2n \times 2n$ 的矩阵，才能避免越界。

```cpp
for (l = 0; l < n; ++l)
    for (i = 0; i < 2 * n - l; ++i)
        j = i + l;
        for (k = i; k < j; ++k)
            dp(i, j) = max(dp(i, k) + dp(k + 1, j) + ...);
```

换种写法，令 $dp(i, l)$ 表示 区间 $[i, i + l]$ 的最优解，$l$ 表示区间长度

$$dp(i, l) = \max_{0\leq k < l}{dp(i, k) + dp(i + k + 1, l - k - 1) + a_ia_{i + k + 1}a_{i + j + 1}}$$

这种要好理解一些，并且省空间： $2n \times n$

```cpp
for (l = 0; l < n; ++l)
    for (i = 0; i < 2 * n - l; ++i)
        for (k = 0; k < l; ++k)
            dp[i][l] = max(dp[i][l], ...);
```

#### [Code](../../cpp/10/p1063.cpp)


