### P1417 烹调方案

算法标签: **动态规划,动规,dp**, **排序**, **背包**
其他标签: **高性能**


#### Description

题目大意： 每种食材有三个参数 $a_i, b_i, c_i$， $c_i$ 表示加工食材所用的时间， $a_i - tb_i$ 为食材加工完成后在 $t$ 时刻的价值（美味程度）。

问如果在有限时间 $T$ 内，选择食材使得美味程度最大？ 

#### Analysis

不愧是 提高组的题。 这题还融合了 P1002 拼数的一些思想。真是变态

包括以下知识点

- 0-1背包问题
- 特殊排序（拼接排序）
- 高精度， 注意 `long long`。 

这题如果没有 $b_i$，一个美味随时间衰减的因子，那么就是普通的 0-1 背包问题。

但是多了一个 $b_i$，就还要考虑一个时间先后问题。

这时候 0-1 背包的状态方程就不对了：

$$dp(n, t) = \max(dp(n - 1, t), dp(n - 1, t - t_n))$$

当前选择的某个食材，如果与前面某个食材调换顺序，有没有可能有个更好的最优解？ 这是不确定的，所以如果有顺序要求的背包问题，还需要考虑 **选择的顺序**。

那么应该如何选择顺序？考虑在任意时刻 $t$ 之后选择的两种相邻的食材 $i, j$

- 原价值：  $a_i - (t + c_i) b_i + a_j - (t + c_i + c_j) b_j$
- 调换后：  $a_j - (t + c_j) b_j + a_i - (t + c_j + c_i) b_i$

比较两个式子，去掉相同的项，最后得到：

- 原价值： $-c_ib_j$
- 调换后： $-c_jb_i$

所以如果 $c_ib_j < c_jb_i$，那么 $i$ 放到前面比 $j$ 放在前面价值更大。 有没有像 P1002 的拼数问题？

对于这种 **拼接背包问题**，先考虑选择的顺序，然后考虑最优的选择。先对每种食材按照 $c_ib_j < c_jb_i$ 排序， 这样在状态方程中，总是能够保证：如果选择当前的食材，把当前食材与前面的食材交换并不可能得到最优解，状态方程总是成立，然后就是常规背包问题了。

拼接排序符合传递律。可以参考 P1002 题解证明。


#### [Code](../cpp/p1417.cpp) 

