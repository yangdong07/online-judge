### P1080 国王游戏

算法标签: **排序**, **贪心**, **进制**, **高精**
其他标签: **NOIp提高组**, **2012**


#### Description

题目大意： 一排人，每人左右手各一个数字。 每个人可以获得前面所有人左手数字的乘积，除以自己右手数字，并向下取整的奖赏。

问如何排列，可以使得 获得最多奖赏的人的 数额最小。（这个最小是指所有排列方案中的最小）。

#### Analysis

这道题可以用贪心算法。 但是一开始贪心的选择并不是那么好看出来。

先看优化目标：

令左手数字数组为 $a_0, a_1, \cdots, a_n$，右手数字数组为 $b_1, b_2, \cdots, b_n$。

第 $i$ 个人可以得到的奖赏是 $ c_i = a_0a_1\dots a_{i-1} / b_i$， 优化目标是 $ \max {c_i}, i = 1, 2, \dots n $， 使这个最大值最小。

贪心算法的一般思路是通过交换来证明一个贪心选择是一个最优解结构的一部分。

设一个排列的的目标值为 $S$，来看一看交换 $i, j$ 会如何改变这个目标值。不妨假设 $i < j$。

注意几点：

1. 交换 $i,j$并不会影响 $i$ 之前的人的奖赏，也不会影响 $j$之后的人的奖赏。
2. 对于 $i$ 的影响是 $c'_ i = c_i * b_i / b_j$
3. 对于 $j$ 的影响是 $c'_ j = c_j * a_jb_j / a_ib_i  $
4. 对于 $k, i < k < j$ 的影响是 $c'_ k = c_k * a_j/a_i$

刚开始的时候我很纠结于这个 $k$，如果中间还有其他的元素，那么很难找出一般规律。

后来才想到，其实没必要纠结。 贪心算法的思路是通过交换，改变一个最优解的结构，变成一个贪心选择的解的过程，并且在改变过程中不会恶化最优解。 如果 $i$ 和 $j$ 相差很远，那么可以先交换相邻元素，逐步交换，来达到交换 $i$ 和 $j$ 的目的。

后来想到的，是受了题解的启发。 题解还是有高人的。 当然有事后诸葛亮的味道。 但是这确实是证明贪心算法的一个思路技巧。

现在令 $i,j$ 是相邻元素。那么有以下关系：

$$\begin{align}
c_j &= c_i * a_i b_i / b_j \\
c_i' & = c_i * b_i / b_j = c_j / a_i\\
c_j' & = c_j * a_jb_j / a_ib_i = c_i * a_j
\end{align}$$

现在三个数都可以通过 $c_i$ 或 $c_j$ 表示。很好。 现在的问题是，交换 $i,j$ 的位置对一个最优解的影响是什么，最好是在交换过程中不会恶化最优解。

如果在最优解中 $c_i = \max{c_k}$，那么可以知道 $c_j \leq c_i$ ，我们希望 $c_i' \leq c_i$， $c_j' \leq c_i$

- $c_i' = c_j/a_i \leq c_j \leq c_i$ 自动成立。
- 如果要满足 $c_j' = c_j * a_jb_j / a_ib_i \leq c_i$ ，因为 $c_j \leq c_i$，一个充分条件是 $a_jb_j \leq a_ib_i$

如果在最优解中 $c_j = \max{c_k}$，那么可以知道 $c_i \leq c_j$， 我们希望 $c_i' \leq c_j$， $c_j' \leq c_j$

- $c_i' = c_j / a_i \leq c_j$ 自动成立
- 如果要满足 $c_j' = c_j * a_jb_j/a_ib_i \leq c_j$，一个充分条件是 $a_jb_j \leq a_ib_i$

所以在交换 $i,j$ 的过程中，如果不想使最优解恶化，一个充分条件是 $a_ib_i \geq a_jb_j$。


到现在为止，我可以知道 贪心解的选择是什么了。其实完全没必要搞的这么复杂。 用两个人稍微分析一下，就知道该如何贪心选择了。

贪心解结构： $a_ib_i$ 小的放前面，大的放后面。
下面证明： 如果有别的形式的最优解，可以通过交换，变成贪心解，并且不会恶化最优解。

例如如果有一个最优解，不是贪心解结构，那么一定存在一个逆序对，$a_ib_i \geq a_jb_j$，并且 $i,j$ 相邻。

由上面过程可知，交换这个逆序对，并不会恶化最优解。 重复此过程直到所有的逆序对都被交换成正序， 都不会恶化最优解，并且最终得到的是贪心顺序。 因此贪心解即为最优解。


#### 小结

以上是按照贪心算法的证明方法证明的。 实际上可以直接证明：一个最优解如果存在逆序对，则可以通过交换变成正序，并且不会恶化最优解。

至于逆序对逆的什么序，用两个人就可以分析出来。

另外吐槽一句，这还需要高精度，真是变态。。

#### [Code](../cpp/p1080.cpp)
